# AstrBot 防撤回插件

## 功能介绍

这是一个 AstrBot 防撤回插件，可以自动检测群聊中的撤回消息，并进行以下操作：

1. **自动捕获撤回消息**：监听群聊中的撤回事件，自动获取撤回的消息内容
2. **AI 智能分析**：使用大语言模型对撤回内容进行分析，生成幽默风趣的锐评
3. **违规内容检测**：自动检测撤回内容是否包含违规关键词，违规内容将不会发送到群聊
4. **精美排版**：将撤回内容和 AI 锐评以精美的排版发送到群聊

## 功能特性

- ✅ 支持群聊消息撤回监听
- ✅ 支持好友消息撤回监听（可选）
- ✅ 自动缓存消息内容
- ✅ AI 智能分析和锐评
- ✅ 违规内容自动过滤
- ✅ 多种锐评风格可选（幽默风趣、严肃认真、毒舌吐槽、温和友善）
- ✅ 支持图片、文本等多种消息类型
- ✅ 可配置是否显示发送者信息

## 安装方法

1. 将插件文件夹 `astrbot_plugin_anti_recall` 放置到 AstrBot 的 `data/plugins` 目录下
2. 在 AstrBot WebUI 的插件管理处启用该插件
3. 在插件配置页面进行个性化配置

## 配置说明

### 基础配置

- **enabled**: 是否启用防撤回功能（默认：true）
- **enable_ai_analysis**: 是否启用 AI 分析和锐评（默认：true）
- **enable_content_filter**: 是否启用违规内容检测（默认：true）
- **enable_private_chat**: 是否在私聊中生效（默认：false）
- **enable_group_chat**: 是否在群聊中生效（默认：true）
- **show_sender_info**: 是否显示发送者信息（默认：true）

### AI 配置

- **ai_comment_prompt**: AI 锐评提示词（默认：幽默风趣风格）
- **comment_style**: 锐评风格（可选：幽默风趣、严肃认真、毒舌吐槽、温和友善）

### 违规检测配置

- **blocked_keywords**: 违规关键词列表（每行一个）

## 使用说明

插件安装并启用后，会自动监听群聊中的撤回消息。当有人撤回消息时，插件会：

1. 获取撤回的消息内容
2. 检查内容是否包含违规关键词
3. 如果内容不违规，调用 AI 进行锐评
4. 将撤回内容和 AI 锐评以精美排版发送到群聊

## 注意事项

1. 插件需要 AstrBot 的 LLM 功能支持，需要配置好聊天模型
2. 插件仅支持 OneBot v11 协议（aiocqhttp 平台）
3. 消息缓存会占用一定的内存，建议定期重启 AstrBot 清理缓存
4. 违规关键词检测基于关键词匹配，可能存在误判，请谨慎使用

## 版本历史

- **v1.0.0** (2026-01-18)
  - 初始版本发布
  - 支持群聊消息撤回监听
  - 支持 AI 分析和锐评
  - 支持违规内容检测

## 许可证

MIT License

## 作者

wangxinghuo

## 反馈与支持

如有问题或建议，欢迎提交 Issue 或 Pull Request。